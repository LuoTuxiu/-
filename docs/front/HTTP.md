# 关于 HTTP 你需要掌握的

## 关于状态码

![](https://user-gold-cdn.xitu.io/2018/7/31/164ed742fc418f41?w=829&h=374&f=png&s=91860)

## http 缓存

http 缓存分两种：

1. 强缓存（取本地浏览器缓存）
2. 协商缓存

| 类型     | 是否会发送实际 http 请求 | 优先级及先后   |
| -------- | ------------------------ | -------------- |
| 强缓存   | 不会                     | 高，优先       |
| 协商缓存 | 会                       | 低，在强缓存后 |

### 强缓存

强缓存读取两个关键的 response header:Cache-Control、expires

#### Cache-Control

Cache-Control 取值

| 值       | 解释                                                      |
| -------- | --------------------------------------------------------- |
| no-cache | 禁用强缓存，但是如果有协商缓存，可以使用协商缓存          |
| no-store | 所有缓存都禁止                                            |
| max-age  | 例如：max-age=100，单位秒数，含义是 该资源缓存时间是 100s |

#### expires

解释为过期时间，浏览器会查看这个请求的 expires 字段，和浏览器本地的时间进行对比，如果此时已经过了这个过期时间，则向服务器发 http 请求请求新的数据。如果没有，则使用本地缓存。但要注意：**expire 记录的是服务器的时间**，因此存在如果用户修改了客户端的时间，则这个时间则可能导致缓存失效的情况

#### Cache-Control 和 expires 的优先级

Cache-Control > expires

> 注意，如果 max-age 和 expires 同时存在，max-age 会覆盖 expires 的作用

### 协商缓存

关键的请求响应 header 头有 last-Modified、Etag。所谓的协商缓存的意思是会向服务器发送一次 http 请求，来判断本地缓存是否需要更新。

#### last-Modified

该资源在服务器最后的更改时间。这个值会在服务器端将资源返回给客户端时附在 response 的 headers 里面，客户端会自动标记该信息，并会在下次需要做协商缓存时带上该信息，如果该时间和服务器此时的最新文件更新时间一致，则返回 状态码 304 Not Modified。

> 问题： 如果服务器该资源内容无变化，仅被修改了时间，则此时 last-Modified 的判断会导致缓存失效

#### Etag

服务器该资源文件的 Md5 的 hash 值。

#### last-Modified 和 Etag 优先级

last-Modified > Etag

## Http2.0 和 1.0、1.1 的区别

### http2.0 特性

1. 多路复用。

一个 http 连接可以同时发送多个请求，同时响应可以异步返回。

实际原理是一个 TCP 连接可以有任意多个流，请求可以分割成一个或者多个帧在流里面传输。帧传输过去后，再进行重组，形成一个完整的请求或者响应。所以所有的请求和响应都无法阻塞。

2. 压缩头部

采用 HPACK 算法。通讯双方各自有 cache 一份 header fields 表。避免了重复 header 的传输，又减少了传输大小。

3. 采用二进制格式传输

4. 服务端推送

服务端推送能把客户端所需要的资源伴随着 index.html 一起发送给客户端，省去了客户端重复请求的步骤。假如我有一个 style.css 的请求，在客户端收到 style.css 的响应时，服务端同时将 style.js 推送给客户端。当客户端再次尝试获取 style.js 时，就可以直接从缓存读取，不用再发请求

### http1.1 特性

1. keep-alive

默认保持一个连接的持久性

2. 线头阻塞，TCP 连接上只能发送一个请求，前面的请求未完成时，后续的请求都在排队等待

3. pipeline 管道

一个 http 连接可以发送多个请求，但是响应只能一个一个接收

4. 采用文本传输，头部冗余，首部未压缩，每一个请求都会带上 cookie, user-agent 等完全相同的首部

### http1.0 特性

1. 默认不开启 keep-alive，如果需要开启，则需要在 header 头指定

```
keep-alive: true
```
